#!/usr/bin/env groovy

// vim: syntax=groovy

@Grab(group='org.codehaus.groovy.modules.http-builder', module='http-builder', version='0.7')
import groovyx.net.http.HTTPBuilder
import groovyx.net.http.AuthConfig

import static groovyx.net.http.ContentType.JSON
import static groovyx.net.http.ContentType.XML
import static groovyx.net.http.Method.GET
import static groovyx.net.http.Method.POST

def home = System.getProperty('user.home')
assert home != null
def token = new File("$home/.github-token").text.trim()
def agent = new File("$home/.github-user").text.trim()
def org = System.env['GITHUB_ORG'] ?: System.getProperty('GITHUB_ORG')
assert org != null : "GITHUB_ORG environment variable must be set"

def url = 'https://api.github.com'
def http = new HTTPBuilder(url)

http.request(GET, JSON) {
  uri.path = "/orgs/$org/teams"
  uri.query = [:]
  headers.Authorization = "token $token"
  headers.'User-Agent' = agent
  response.success = { resp, json ->
    json.each {
      println "${it.id}: ${it.slug}"
    }
  }
}
